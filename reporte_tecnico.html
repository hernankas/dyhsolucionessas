<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Reporte Técnico - D&H Soluciones SAS</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 1000px;
            width: 100%;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        h2 {
            grid-column: span 2;
            text-align: center;
            color: #004d99;
            margin-bottom: 20px;
            font-size: 24px;
        }
        label {
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 14px;
            background-color: #f0f0f0;
        }
        textarea {
            grid-column: span 2;
            resize: vertical;
            min-height: 80px;
        }
        button {
            background-color: #004d99;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            grid-column: span 2;
        }
        #signature-pad {
            border: 1px solid #ccc;
            border-radius: 5px;
            grid-column: span 2;
            width: 100%;
            height: 150px;
            background-color: #fff;
        }
        #clear-signature {
            background-color: red;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>Generar Reporte Técnico</h2>

        <label for="orden">Número de Orden:</label>
        <input type="text" id="orden" name="orden" readonly>

        <label for="cliente">Nombre del Cliente:</label>
        <input type="text" id="cliente" name="cliente" required>

        <label for="tipoServicio">Tipo de Servicio:</label>
        <select id="tipoServicio" name="tipoServicio" required>
            <option value="correctivo">Mantenimiento Correctivo</option>
            <option value="preventivo">Mantenimiento Preventivo</option>
            <option value="revision">Revisión</option>
            <option value="pruebas">Pruebas</option>
            <option value="otro">Otro</option>
        </select>

        <label for="equipo">Descripción del Equipo:</label>
        <input type="text" id="equipo" name="equipo" required>

        <label for="marca">Marca:</label>
        <input type="text" id="marca" name="marca" required>

        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" required>

        <label for="serie">Serie:</label>
        <input type="text" id="serie" name="serie" required>

        <label for="voltaje">Voltaje (V1, V2, V3):</label>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="voltajeV1" name="voltajeV1" placeholder="Voltaje V1" required>
            <input type="text" id="voltajeV2" name="voltajeV2" placeholder="Voltaje V2" required>
            <input type="text" id="voltajeV3" name="voltajeV3" placeholder="Voltaje V3" required>
        </div>

        <label for="amperaje">Amperaje (L1, L2, L3):</label>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="amperajeL1" name="amperajeL1" placeholder="Amperaje L1" required>
            <input type="text" id="amperajeL2" name="amperajeL2" placeholder="Amperaje L2" required>
            <input type="text" id="amperajeL3" name="amperajeL3" placeholder="Amperaje L3" required>
        </div>

        <label for="horaInicio">Hora Inicial:</label>
        <input type="time" id="horaInicio" name="horaInicio" required>

        <label for="horaFin">Hora Final:</label>
        <input type="time" id="horaFin" name="horaFin" required>

        <label for="actividades">Descripción de Actividades Realizadas:</label>
        <textarea id="actividades" name="actividades" rows="5" required></textarea>

        <label for="fecha">Fecha del Reporte:</label>
        <input type="date" id="fecha" name="fecha" required>

        <label for="nombreTecnico">Nombre del Técnico:</label>
        <input type="text" id="nombreTecnico" name="nombreTecnico" required>

        <label for="signature-pad">Firma del Cliente:</label>
        <canvas id="signature-pad"></canvas>
        <button type="button" id="clear-signature">Limpiar Firma</button>

        <button type="button" onclick="generarPDF()">Generar PDF</button>
    </div>

    <script>
        const canvas = document.getElementById('signature-pad');
        const signaturePad = new SignaturePad(canvas);

        document.getElementById('clear-signature').addEventListener('click', function () {
            signaturePad.clear();
        });

        function generarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Pedir al usuario una contraseña antes de generar el PDF
            const password = prompt("Por favor, ingrese una contraseña para proteger el archivo PDF:");

            if (!password) {
                alert("Por favor, ingrese una contraseña válida.");
                return;
            }

            // Obtener los valores del formulario
            const orden = document.getElementById("orden").value;
            const cliente = document.getElementById("cliente").value;
            const tipoServicio = document.getElementById("tipoServicio").value;
            const equipo = document.getElementById("equipo").value;
            const marca = document.getElementById("marca").value;
            const modelo = document.getElementById("modelo").value;
            const serie = document.getElementById("serie").value;
            const voltajeV1 = document.getElementById("voltajeV1").value;
            const voltajeV2 = document.getElementById("voltajeV2").value;
            const voltajeV3 = document.getElementById("voltajeV3").value;
            const amperajeL1 = document.getElementById("amperajeL1").value;
            const amperajeL2 = document.getElementById("amperajeL2").value;
            const amperajeL3 = document.getElementById("amperajeL3").value;
            const horaInicio = document.getElementById("horaInicio").value;
            const horaFin = document.getElementById("horaFin").value;
            const actividades = document.getElementById("actividades").value;
            const fecha = document.getElementById("fecha").value;
            const nombreTecnico = document.getElementById("nombreTecnico").value;

            // Información de la empresa
            const empresaInfo = [
                ["D&H Soluciones SAS"],
                ["NIT: 123456789"],
                ["Teléfono: +57 312 3456789"],
                ["Dirección: Calle 123 #45-67, Medellín, Colombia"]
            ];

            doc.autoTable({
                body: empresaInfo,
                styles: { fontSize: 10, cellPadding: 3, halign: 'center' },
            });

            const orderInfo = [
                ["ORDEN DE TRABAJO No", orden],
                ["FECHA", fecha],
                ["CLIENTE", cliente],
                ["TIPO SERVICIO", tipoServicio]
            ];

            doc.autoTable({
                body: orderInfo,
                styles: { fontSize: 10, cellPadding: 3, halign: 'left' },
                startY: doc.previousAutoTable.finalY + 10,
            });

            // Información del equipo
            const equipmentInfo = [
                ["EQUIPO", equipo],
                ["MARCA", marca],
                ["MODELO", modelo],
                ["SERIE", serie],
                ["VOLTAGE", `V1: ${voltajeV1} V  V2: ${voltajeV2} V  V3: ${voltajeV3} V`],
                ["AMPERAJE", `L1: ${amperajeL1} A  L2: ${amperajeL2} A  L3: ${amperajeL3} A`],
                ["HORA INICIO", horaInicio],
                ["HORA FIN", horaFin]
            ];

            doc.autoTable({
                body: equipmentInfo,
                styles: { fontSize: 10, cellPadding: 3, halign: 'left' },
                startY: doc.previousAutoTable.finalY + 10,
            });

            // Actividades realizadas
            doc.text("Actividades Realizadas:", 14, doc.previousAutoTable.finalY + 20);
            doc.text(actividades, 14, doc.previousAutoTable.finalY + 30, { maxWidth: 180 });

            // Firma del cliente
            if (!signaturePad.isEmpty()) {
                const signatureImage = signaturePad.toDataURL();
                doc.text("Firma del Cliente:", 14, doc.previousAutoTable.finalY + 50);
                doc.addImage(signatureImage, 'PNG', 14, doc.previousAutoTable.finalY + 60, 50, 25);
            } else {
                doc.text("Firma del Cliente: No se ha proporcionado firma.", 14, doc.previousAutoTable.finalY + 50);
            }

            // Firma del técnico
            doc.text("Firma del Técnico: " + nombreTecnico, 14, doc.previousAutoTable.finalY + 90);

            // Proteger el archivo con la contraseña proporcionada
            doc.setProperties({
                title: `Reporte Técnico - ${cliente}`,
                subject: 'Reporte Técnico generado por D&H Soluciones SAS',
                author: 'D&H Soluciones SAS',
                keywords: 'reporte técnico, pdf, D&H Soluciones',
                creator: 'D&H Soluciones SAS',
            });

            doc.addPassword({
                userPassword: password,
                ownerPassword: password,
                permissions: {
                    printing: 'highResolution',
                    modifying: false,
                    copying: false,
                    annotating: true,
                }
            });

            // Guardar el PDF
            doc.save(`reporte_tecnico_${orden}_${cliente}.pdf`);
        }
    </script>
</body>
</html>
